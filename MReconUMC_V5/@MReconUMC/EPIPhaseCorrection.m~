function EPIPhaseCorrection( MR )
% Overload EPI phase correction function

% logic
if ~strcmpi(MR.Parameter.Scan.FastImgMode,'EPI')
    return; end

% Dimensionality
Kd=MR.UMCParameters.AdjointReconstruction.KspaceSize{1};
Id=MR.Parameter.Gridder.OutputMatrixSize{1};

% Reshape calibration data to [Kd(1) Kd(2) Kd(4)]
calib_data=permute(reshape(MR.UMCParameters.SystemCorrections.CalibrationData,[Kd(1) Kd(4) Kd(2)]),[1 3 4 2]);
MR.UMCParameters.SystemCorrections.CalibrationData=[];

% Determine phase at k0 for each readout and receiver
%phase_correction_mtx=zeros(Kd);

% First very coarse approach
cp=ceil(Kd(1)/2)+1;
for c=1:Kd(4)
    for pe=1:2:Kd(2)-1
        phase_correction_mtx(pe,c)=angle(calib_data(cp,pe,1,c))-angle(calib_data(cp,pe+1,1,c));
    end
end


%END
end


%n1d_for=@(y)(nufft(y,d));
